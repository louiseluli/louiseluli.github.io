<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cinema Analytics | Louise Ferreira</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
      :root {
        --primary: #8b5cf6;
        --secondary: #ec4899;
        --accent: #10b981;
        --dark: #0f172a;
        --light: #1e293b;
        --text: #f8fafc;
        --muted: #94a3b8;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: var(--dark);
        color: var(--text);
        line-height: 1.6;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 2rem;
      }

      .header {
        text-align: center;
        margin-bottom: 3rem;
      }

      .header h1 {
        font-size: 3rem;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 1rem;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-bottom: 3rem;
      }

      .stat-box {
        background: var(--light);
        padding: 2rem;
        border-radius: 12px;
        text-align: center;
        border: 1px solid transparent;
        transition: all 0.3s;
      }

      .stat-box:hover {
        border-color: var(--primary);
        transform: translateY(-5px);
      }

      .stat-box i {
        font-size: 2.5rem;
        color: var(--primary);
        margin-bottom: 1rem;
      }

      .stat-value {
        font-size: 2.5rem;
        font-weight: 700;
        margin: 0.5rem 0;
      }

      .stat-label {
        color: var(--muted);
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .chart-container {
        background: var(--light);
        padding: 2rem;
        border-radius: 12px;
        margin-bottom: 2rem;
      }

      .chart-title {
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .chart-wrapper {
        position: relative;
        height: 400px;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
      }

      .card {
        background: var(--dark);
        padding: 1.5rem;
        border-radius: 8px;
        border: 1px solid rgba(148, 163, 184, 0.2);
        transition: all 0.3s;
      }

      .card:hover {
        border-color: var(--primary);
        transform: translateY(-3px);
      }

      .error {
        background: #dc2626;
        color: white;
        padding: 2rem;
        border-radius: 12px;
        margin: 2rem 0;
      }

      .loading {
        text-align: center;
        padding: 3rem;
        color: var(--muted);
      }

      .keyword-cloud {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin: 1rem 0;
      }

      .keyword {
        background: var(--dark);
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.9rem;
        border: 1px solid var(--primary);
        transition: all 0.3s;
      }

      .keyword:hover {
        background: var(--primary);
        transform: scale(1.05);
      }
    </style>
    <link rel="stylesheet" href="../css/cinema-dashboard.css" />
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1><i class="fas fa-film"></i> Cinema Analytics</h1>
        <p style="color: var(--muted); font-size: 1.2rem">
          Comprehensive movie analysis with AI insights
        </p>
      </div>

      <div id="loading" class="loading">
        <i
          class="fas fa-spinner fa-spin"
          style="font-size: 3rem; color: var(--primary)"
        ></i>
        <p style="margin-top: 1rem; font-size: 1.2rem">
          Loading cinema data...
        </p>
      </div>

      <div id="error" style="display: none"></div>
      <div id="content" style="display: none"></div>
    </div>

    <script>
      // Try multiple paths
      const DATA_PATHS = [
        "../data/data/cinema_insights.json",
        "data/data/cinema_insights.json",
        "../data/cinema_insights.json",
        "data/cinema_insights.json",
        "./data/data/cinema_insights.json",
        "./data/cinema_insights.json",
      ];

      let chartsData = {};

      async function loadData() {
        console.log("üîç Searching for cinema_insights.json...");

        for (const path of DATA_PATHS) {
          try {
            console.log(`Trying: ${path}`);
            const response = await fetch(path);

            if (response.ok) {
              const data = await response.json();
              console.log(`‚úÖ Success! Loaded from: ${path}`);
              console.log("Data:", data);
              return data;
            }
          } catch (error) {
            console.log(`‚ùå Failed: ${path} - ${error.message}`);
          }
        }

        throw new Error("Could not load cinema_insights.json from any path");
      }

      function showError(message, paths) {
        document.getElementById("loading").style.display = "none";
        document.getElementById("error").style.display = "block";
        document.getElementById("error").innerHTML = `
                <div class="error">
                    <h2><i class="fas fa-exclamation-triangle"></i> Error Loading Data</h2>
                    <p style="margin: 1rem 0;">${message}</p>
                    <p><strong>Tried these paths:</strong></p>
                    <ul style="margin: 1rem 0; padding-left: 2rem;">
                        ${paths.map(p => `<li><code>${p}</code></li>`).join("")}
                    </ul>
                    <p><strong>Solution:</strong></p>
                    <ol style="margin: 1rem 0; padding-left: 2rem;">
                        <li>Make sure you ran: <code>python scripts/analyze_data.py</code></li>
                        <li>Check that <code>data/data/cinema_insights.json</code> exists</li>
                        <li>Open this page from the correct location (pages/cinema.html)</li>
                    </ol>
                </div>
            `;
      }

      function renderStats(data) {
        const stats = data.basic_stats;
        return `
                <div class="stats-grid">
                    <div class="stat-box">
                        <i class="fas fa-film"></i>
                        <div class="stat-value">${stats.total_movies.toLocaleString()}</div>
                        <div class="stat-label">Total Movies</div>
                    </div>
                    <div class="stat-box">
                        <i class="fas fa-clock"></i>
                        <div class="stat-value">${stats.total_runtime_hours.toLocaleString()}</div>
                        <div class="stat-label">Hours Watched</div>
                    </div>
                    <div class="stat-box">
                        <i class="fas fa-calendar"></i>
                        <div class="stat-value">${
                          stats.year_range.span || "N/A"
                        }</div>
                        <div class="stat-label">Year Span</div>
                    </div>
                    <div class="stat-box">
                        <i class="fas fa-masks-theater"></i>
                        <div class="stat-value">${
                          data.genres.total_unique_genres
                        }</div>
                        <div class="stat-label">Genres</div>
                    </div>
                    <div class="stat-box">
                        <i class="fas fa-user-tie"></i>
                        <div class="stat-value">${
                          Object.keys(data.directors).length
                        }</div>
                        <div class="stat-label">Directors</div>
                    </div>
                    ${
                      data.actors && data.actors.total_actors
                        ? `
                    <div class="stat-box">
                        <i class="fas fa-star"></i>
                        <div class="stat-value">${data.actors.total_actors.toLocaleString()}</div>
                        <div class="stat-label">Actors</div>
                    </div>
                    `
                        : ""
                    }
                </div>
            `;
      }

      function renderGenreChart(data) {
        setTimeout(() => {
          const ctx = document.getElementById("genreChart");
          const genres = data.genres.top_10_genres;

          new Chart(ctx, {
            type: "bar",
            data: {
              labels: Object.keys(genres),
              datasets: [
                {
                  label: "Movies",
                  data: Object.values(genres),
                  backgroundColor: [
                    "#8B5CF6",
                    "#9333EA",
                    "#A855F7",
                    "#B794F4",
                    "#C4B5FD",
                    "#DDD6FE",
                    "#EC4899",
                    "#F472B6",
                    "#10B981",
                    "#F59E0B",
                  ],
                  borderRadius: 8,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: { display: false },
              },
              scales: {
                y: {
                  beginAtZero: true,
                  grid: { color: "rgba(148, 163, 184, 0.1)" },
                },
                x: { grid: { display: false } },
              },
            },
          });
        }, 100);
      }

      function renderDecadeChart(data) {
        setTimeout(() => {
          const ctx = document.getElementById("decadeChart");
          const decades = Object.keys(data.decades).sort();
          const counts = decades.map(d => data.decades[d].count);

          new Chart(ctx, {
            type: "line",
            data: {
              labels: decades.map(d => d + "s"),
              datasets: [
                {
                  label: "Movies",
                  data: counts,
                  backgroundColor: "rgba(139, 92, 246, 0.2)",
                  borderColor: "#8B5CF6",
                  borderWidth: 3,
                  fill: true,
                  tension: 0.4,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  beginAtZero: true,
                  grid: { color: "rgba(148, 163, 184, 0.1)" },
                },
                x: { grid: { color: "rgba(148, 163, 184, 0.1)" } },
              },
            },
          });
        }, 100);
      }

      function renderContent(data) {
        const content = document.getElementById("content");

        content.innerHTML = `
                ${renderStats(data)}
                
                <div class="chart-container">
                    <h2 class="chart-title"><i class="fas fa-chart-bar"></i> Top Genres</h2>
                    <div class="chart-wrapper">
                        <canvas id="genreChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h2 class="chart-title"><i class="fas fa-calendar-alt"></i> Movies by Decade</h2>
                    <div class="chart-wrapper">
                        <canvas id="decadeChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h2 class="chart-title"><i class="fas fa-user-tie"></i> Top Directors</h2>
                    <div class="grid">
                        ${Object.entries(data.directors)
                          .slice(0, 12)
                          .map(
                            ([name, info], i) => `
                            <div class="card">
                                <h3 style="color: var(--primary);">#${
                                  i + 1
                                } ${name}</h3>
                                <p style="color: var(--muted); margin-top: 0.5rem;">
                                    <i class="fas fa-film"></i> ${
                                      info.movie_count
                                    } movies ¬∑ 
                                    <i class="fas fa-clock"></i> ${info.total_runtime_hours.toFixed(
                                      1
                                    )}h
                                </p>
                            </div>
                        `
                          )
                          .join("")}
                    </div>
                </div>
                
                ${
                  data.actors &&
                  data.actors.top_actors &&
                  Object.keys(data.actors.top_actors).length > 0
                    ? `
                <div class="chart-container">
                    <h2 class="chart-title"><i class="fas fa-star"></i> Top Actors</h2>
                    <div class="grid">
                        ${Object.entries(data.actors.top_actors)
                          .slice(0, 20)
                          .map(
                            ([name, info], i) => `
                            <div class="card">
                                <h3 style="color: var(--secondary);">#${
                                  i + 1
                                } ${name}</h3>
                                <p style="color: var(--muted); margin-top: 0.5rem;">
                                    <i class="fas fa-film"></i> ${
                                      info.appearances
                                    } appearances
                                    ${
                                      info.birth_year
                                        ? ` ¬∑ <i class="fas fa-calendar"></i> ${info.birth_year}`
                                        : ""
                                    }
                                </p>
                            </div>
                        `
                          )
                          .join("")}
                    </div>
                </div>
                `
                    : ""
                }
                
                ${
                  data.ml_insights && data.ml_insights.genre_clustering
                    ? `
                <div class="chart-container">
                    <h2 class="chart-title"><i class="fas fa-robot"></i> AI Genre Clusters</h2>
                    <div class="grid">
                        ${Object.entries(data.ml_insights.genre_clustering)
                          .map(
                            ([cluster, info]) => `
                            <div class="card">
                                <h3 style="color: var(--accent);">${cluster}</h3>
                                <p style="color: var(--muted); margin-top: 0.5rem;">
                                    ${info.size} movies (${info.percentage}%)
                                </p>
                            </div>
                        `
                          )
                          .join("")}
                    </div>
                </div>
                `
                    : ""
                }
            `;

        content.style.display = "block";
        renderGenreChart(data);
        renderDecadeChart(data);
      }

      // Initialize
      async function init() {
        try {
          const data = await loadData();
          document.getElementById("loading").style.display = "none";
          renderContent(data);
        } catch (error) {
          showError(error.message, DATA_PATHS);
        }
      }

      init();
    </script>
  </body>
</html>
